---
title: "England Peat Depth Model: Data Preparation"
output: html_notebook
---

#Peat Depths: model selection script

## Packages 
```{r}
library(raster)
library(rgdal)
library(eply) # for unquoting ls objects
```


## Import data ----
```{r}
list.files(path = "../data")
list.files(path = "../data/peat_depth_data/")
```

### Import the main file geodatabase 

currently peat depth data is not in there
```{r}
fgdb <- "../data/PeatDepth.gdb"
  # List all feature classes in a file geodatabase
  subset(ogrDrivers(), grepl("GDB", name))
  fc_list <- ogrListLayers(fgdb)
  print(fc_list)
```


### Import peat depth file
```{r}
pdshp <- "../data/peat_depth_data/Combined_Peat_Depth_Survey_Data_NOV2012_ALLDATA.shp"
ogrInfo(pdshp)

#save the shapefile into an object
peat.depth <- readOGR(dsn = pdshp, verbose = TRUE)

# Determine the FC extent, projection, and attribute information
summary(peat.depth)
  # plot(peat.depth, pch = 21, cex = 0.25)
```

### Import environmental and topographic data
```{r}
# #elevation 
# elev <- raster("../data/Ground Elevation © CEH1.tif")
# 
# #surface type 
# surf <- raster("../data/Surface Type © CEH1.tif")
# 
# #inflow pattern
# inflow <- raster("../data/Inflow Pattern © CEH1.tif")
# 
# #outflow pattern
# outflow <- raster("../data/Outflow Pattern © CEH1.tif")
#
# #save to file
#save(list = c("elev", "surf", "inflow", "outflow"), file = "../data/topo_env_data.rda")

load(file = "../data/topo_env_data.rda")
```

## Import UKCP09 climate data

These data are Met Office figures produced for the UK Climate Projections 2009 and available from www.ceda.ac.uk (collection ukcp09, 5km gridded long term averages).  The process for reading and converting them to raster format, as well as the calculation of derived values (such as seasonal figures) are contained in the script `ukcp09DataImport.R`.  

```{r}
# load data rasters

# Annual data rasters
load(file = "../data/ukcp09GriddedDataAnn.rda")

# Seasonal data rasters
# load(file = "../data/ukcp09GriddedDataSease.rda")

# monthly data rasters - lots of objects
# load(file = "../data/ukcp09GriddedDataMonthly.rda")
```

resample rasters
```{r}
# resample: x = raster to be resampled, y = raster to be resampled to
ls(pattern = "1960_90")
gdd_1960_90_ann <- resample(gdd_1960_90_ann, elev)
gsl_1960_90_ann <- resample(gsl_1960_90_ann, elev)
rain_1960_90_ann <- resample(rain_1960_90_ann, elev)
rain_daily_mean_1960_90_annual <- resample(rain_daily_mean_1960_90_annual, elev)
raindays_10mm_1960_90_annual <- resample(raindays_10mm_1960_90_annual, elev)
raindays_1mm_1960_90_annual <- resample(raindays_1mm_1960_90_annual, elev)
temp_max_1960_90_annual <- resample(temp_max_1960_90_annual, elev)
temp_mean_1960_90_annual <- resample(temp_mean_1960_90_annual, elev)
temp_min_1960_90_annual <- resample(temp_min_1960_90_annual, elev)
```


####calculate derrived data ----
 
```{r}
slope <- terrain(x = elev, opt = "slope", unit = "radians", neighbors = 8)
#   # summary(slope)
#   #  plot(slope)

aspect <- terrain(x = elev, opt = "aspect", unit = "degrees", neighbors = 8)
#   #  summary(aspect)
#   #  plot(aspect)
```

## Create input dataset

```{r}
# input.data <- as.data.frame(peat.depth$PEAT_DEPTH)
# names(input.data) <- "PEAT_DEPTH"
# input.data$elev <- extract(elev, coordinates(peat.depth)[,1:2])
# input.data$aspect <- extract(aspect, coordinates(peat.depth)[,1:2])
# input.data$slope <- extract(slope, coordinates(peat.depth)[,1:2])
#need to add the other variables
```

## export to file

```{r}
#saveRDS(input.data, file="data/input.data.rds")
#write.csv(input.data, file = "input_data.csv", row.names = F)
```
