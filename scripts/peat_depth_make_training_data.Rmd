---
title: "England Peat Depth Model: Create training data"
output: html_notebook
---

#Peat Depths: create training data script

## Packages 
```{r}
library(raster)
library(rgdal)
```

## Import data

### Import peat depth file
```{r}
pdshp <- "../data/peat_depth_data/Combined_Peat_Depth_Survey_Data_NOV2012_ALLDATA.shp"
ogrInfo(pdshp)

#save the shapefile into an object
peat.depth <- readOGR(dsn = pdshp, verbose = TRUE)

rm(pdshp)
# Determine the FC extent, projection, and attribute information
#summary(peat.depth)
  # plot(peat.depth, pch = 21, cex = 0.25)
```

### Import predictor data
```{r}
# Import environmental and topographic data
load(file = "../data/topo_env_data.rds")

# Import UKCP09 climate data
load(file = "../data/ukcp09GriddedDataAnnPrepd.rds")
```

## Create input dataset

```{r}
#create dataframe with peat depth as first col
input.data <- as.data.frame(peat.depth$PEAT_DEPTH)
names(input.data) <- "PEAT_DEPTH"

#populate longitude and lattitude
input.data$lon <- coordinates(peat.depth)[,1]
input.data$lat <- coordinates(peat.depth)[,2]

#extract environmental and topographic data for each peat depth measurement
input.data$elev <- extract(
  elev, coordinates(peat.depth)[,1:2])
input.data$aspect <- extract(
  aspect, coordinates(peat.depth)[,1:2])
input.data$slope <- extract(
  slope, coordinates(peat.depth)[,1:2])
input.data$outflow <- extract(
  outflow, coordinates(peat.depth)[,1:2])
input.data$inflow <- extract(
  inflow, coordinates(peat.depth)[,1:2])
input.data$surf <- extract(
  surf, coordinates(peat.depth)[,1:2])

#extract climate data for each peat depth measurement
input.data$gdd <- extract(
  gdd_1960_90_ann, coordinates(peat.depth)[,1:2])
input.data$gsl <- extract(
  gsl_1960_90_ann, coordinates(peat.depth)[,1:2])
input.data$rain_ann <- extract(
  rain_1960_90_annual, coordinates(peat.depth)[,1:2])
input.data$rain_daily <- extract(
  rain_daily_mean_1960_90_annual, coordinates(peat.depth)[,1:2])
input.data$raindays_10mm <- extract(
  raindays_10mm_1960_90_annual, coordinates(peat.depth)[,1:2])
input.data$raindays_1mm <- extract(
  raindays_1mm_1960_90_annual, coordinates(peat.depth)[,1:2])
input.data$temp_mean <- extract(
  temp_mean_1960_90_annual, coordinates(peat.depth)[,1:2])
input.data$temp_min <- extract(
  temp_min_1960_90_annual, coordinates(peat.depth)[,1:2])
input.data$temp_max <- extract(
  temp_max_1960_90_annual, coordinates(peat.depth)[,1:2])
```

## export to file

```{r}
save(input.data, file="../data/input.data.rds")
write.csv(input.data, file = "../data/input_data.csv", row.names = F)
```
