---
title: "England Peat Depth Model: Train ensemble models"
output: html_notebook
---

Courtesy of https://amunategui.github.io/blending-models/


Note: this needs to be abandoned, because the example is a classification problem not a regression problem.  


## Packages 
```{r, include=FALSE}
library(raster)
library(rgdal)

library(caret)
library(parallel)
library(doParallel)

library(pROC)
```

## Load data
```{r}
load(file = "../data/input.data.rds")
```


## Start Parallel Processing
```{r}
detectCores()
getDoParWorkers()
cl <- makeCluster(detectCores()-1)
registerDoParallel(cl)
getDoParName()
getDoParWorkers()
#registerDoSEQ() # to stop parallel processing
```


## Make training and test sets
split into three parts: `ensembleData`, `blenderData`, `testingData`.

```{r}
set.seed(1234)
input.data <- input.data[sample(nrow(input.data)),]
split <- floor(nrow(input.data)/3)
ensembleData <- input.data[0:split,]
blenderData <- input.data[(split+1):(split*2),]
testingData <- input.data[(split*2+1):nrow(input.data),]
```


```{r}
labelName <- 'PEAT_DEPTH'
predictors <- names(ensembleData)[names(ensembleData) != labelName]
```

control the number of cross-validations performed (the more the better):

```{r}
myControl <- trainControl(method='cv', number=3, returnResamp='none')
```


## Benchmark model

create a benchmark model to compare others against.  Using `gbm` Generalized Boosted Regression Model
```{r}
test_model <- train(blenderData[,predictors], blenderData[,labelName], method='gbm', trControl=myControl)
```


train and evaluate benchmark model
```{r}
preds <- predict(object=test_model, testingData[,predictors])
auc <- roc(testingData[,labelName], preds) #area under curve
print(auc$auc)
auc.multi <- multiclass.roc(testingData[,labelName], preds)
```

## Create emsembles

